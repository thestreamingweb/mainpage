<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Movie - The Streaming</title>
    <style>
        body { background-color: #0f0f0f; color: white; font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        .container { max-width: 800px; margin: auto; }
        #timer-box { background: #1c1c1c; padding: 40px; border-radius: 15px; margin-top: 50px; }
        #countdown { font-size: 48px; font-weight: bold; color: #ff4757; }
        #player-container { display: none; margin-top: 20px; }
        iframe { width: 100%; height: 450px; border: none; border-radius: 10px; background: black; }
        .ad-space { margin: 20px 0; min-height: 100px; }
    </style>
</head>
<body>

    <div class="container">
        <h2>The Streaming</h2>

        <div id="timer-box">
            <h3>Please wait while your movie is loading...</h3>
            <div id="countdown">15</div>
            <p>Your video will appear automatically.</p>
        </div>

        <div id="player-container">
            <div id="video-wrapper"></div>
        </div>

        <div class="ad-space">
            </div>
    </div>

    <script>
        let timeLeft = 15;
        const countdownElement = document.getElementById('countdown');
        const timerBox = document.getElementById('timer-box');
        const playerContainer = document.getElementById('player-container');
        const videoWrapper = document.getElementById('video-wrapper');

        // 1. Get the link from the URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        let movieLink = urlParams.get('link');

        // 2. Timer Countdown
        const timer = setInterval(() => {
            timeLeft--;
            countdownElement.innerText = timeLeft;

            if (timeLeft <= 0) {
                clearInterval(timer);
                showVideo();
            }
        }, 1000);

        // 3. Logic to show the Video
        function showVideo() {
            if (!movieLink) {
                timerBox.innerHTML = "<h3>Error: No movie link found!</h3>";
                return;
            }

            // Fix Google Drive links for embedding
            // We change '/view' or 'uc?export=download' to '/preview'
            let finalEmbedLink = movieLink;
            if (movieLink.includes("drive.google.com")) {
                // Extracts the File ID and creates the /preview link
                const fileId = movieLink.match(/[-\w]{25,}/);
                if (fileId) {
                    finalEmbedLink = `https://drive.google.com/file/d/${fileId[0]}/preview`;
                }
            }

            // Hide timer and show player
            timerBox.style.display = "none";
            playerContainer.style.display = "block";

            // Insert the iframe
            videoWrapper.innerHTML = `
                <iframe 
                    src="${finalEmbedLink}" 
                    allow="autoplay" 
                    allowfullscreen>
                </iframe>`;
        }
    </script>
</body>
</html>
